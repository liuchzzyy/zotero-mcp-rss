"""
Template configuration for AI analysis.

Supports loading analysis questions and templates from environment variables
or configuration files.
"""

from typing import Any

from zotero_mcp.utils.config import load_config

# -------------------- Default Templates --------------------


DEFAULT_ANALYSIS_QUESTIONS = [
    "è¿™ç¯‡è®ºæ–‡çš„ä¸»è¦ç ”ç©¶é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ",
    "å¼•ç”¨çš„æ–‡çŒ®æ˜¯å¦æœ€æ–°ã€å…¨é¢ï¼Ÿä»¥å¾€æ–‡çŒ®æœ‰ä»€ä¹ˆä¸è¶³ï¼Ÿ",
    "æœ¬ç ”ç©¶èšç„¦çš„é—®é¢˜ã€é€»è¾‘æ€è·¯ã€å¯è¡Œæ€§å’Œå¯é æ€§å¦‚ä½•ï¼Ÿ",
    "ä½œè€…é€‰é¢˜è§’åº¦æ˜¯å¦æ–°é¢–ï¼Ÿæœ‰ä»€ä¹ˆä»·å€¼ï¼Ÿ",
    "æå‡ºäº†ä»€ä¹ˆæ–°çš„ç§‘å­¦é—®é¢˜ï¼Ÿ",
    "åœ¨åˆ¶å¤‡æ–¹æ³•ä¸Šæœ‰ä»€ä¹ˆåˆ›æ–°ï¼Ÿ",
    "ç ”ç©¶æ€è·¯æœ‰ä½•ç‹¬ç‰¹ä¹‹å¤„ï¼Ÿ",
    "ä½¿ç”¨äº†ä»€ä¹ˆæ–°çš„ç ”ç©¶å·¥å…·æˆ–æŠ€æœ¯ï¼Ÿ",
    "åœ¨ç†è®ºæ–¹é¢æœ‰ä½•è´¡çŒ®ï¼Ÿ",
    "å…³é”®çš„åˆ¶å¤‡æ–¹æ³•å’Œæ­¥éª¤æ˜¯ä»€ä¹ˆï¼Ÿ",
    "ä½¿ç”¨äº†å“ªäº›è¡¨å¾æ–¹æ³•ï¼Ÿä¸»è¦ç»“æžœæ˜¯ä»€ä¹ˆï¼Ÿ",
    "å…³é”®æ€§èƒ½æ•°æ®å’ŒæŒ‡æ ‡æœ‰å“ªäº›ï¼Ÿ",
    "ä½œè€…æå‡ºçš„æœºåˆ¶è§£é‡Šæ˜¯ä»€ä¹ˆï¼Ÿ",
    "ç†è®ºåŸºç¡€å’Œæ¨¡åž‹æ˜¯ä»€ä¹ˆï¼Ÿ",
    "è¿™ç¯‡è®ºæ–‡æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œä¸è¶³ï¼Ÿ",
]

DEFAULT_ANALYSIS_TEMPLATE_JSON = """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ç§‘ç ”æ–‡çŒ®åˆ†æžåŠ©æ‰‹ã€‚è¯·åŸºäºŽè®ºæ–‡æ–‡æœ¬ã€æ‰¹æ³¨ã€å›¾è¡¨çº¿ç´¢å’Œå‚è€ƒæ–‡çŒ®ï¼Œè¾“å‡ºç»“æž„åŒ–ã€è¯æ®é©±åŠ¨çš„åˆ†æžç»“æžœã€‚

## è®ºæ–‡åŸºæœ¬ä¿¡æ¯

- **æ ‡é¢˜**: {title}
- **ä½œè€…**: {authors}
- **æœŸåˆŠ**: {journal}
- **å‘è¡¨æ—¥æœŸ**: {date}
- **DOI**: {doi}

## è®ºæ–‡å…¨æ–‡

{fulltext}

{annotations_section}
{images_section}

---

è¯·ä¸¥æ ¼è¿”å›žä¸€ä¸ª JSON ä»£ç å—ï¼Œé¡¶å±‚å¿…é¡»æ˜¯ `{"sections": [...]}`ã€‚



## å¿…é¡»è¦†ç›–çš„ç« èŠ‚ï¼ˆä¸Žé»˜è®¤æ¨¡æ¿ä¿æŒä¸€è‡´ï¼‰

è¯·æŒ‰é¡ºåºè¾“å‡ºä»¥ä¸‹ç« èŠ‚ï¼š
1. ðŸ§­ é˜…è¯»åè®®
2. ðŸ“– ç²—è¯»ç­›é€‰
3. ðŸ§© ç‰ˆå¼ä¸Žä¿¡æ¯æž¶æž„åˆ†æž
4. ðŸ“š å‰è¨€åŠæ–‡çŒ®ç»¼è¿°ï¼ˆå¼•ç”¨æ–‡çŒ®è¯„ä¼° / èšç„¦é—®é¢˜ / é€‰é¢˜æ–°é¢–æ€§ï¼‰
5. ðŸ“Ž å‚è€ƒæ–‡çŒ®ï¼ˆå›ºå®š Markdown è¡¨æ ¼ï¼Œ3-5 ç¯‡ï¼Œä¸è¶…è¿‡5ç¯‡ï¼‰
6. ðŸ’¡ åˆ›æ–°ç‚¹ï¼ˆç§‘å­¦é—®é¢˜ / åˆ¶å¤‡æ–¹æ³• / ç ”ç©¶æ€è·¯ / ç ”ç©¶å·¥å…· / ç ”ç©¶ç†è®ºï¼‰
7. ðŸ“ ç¬”è®°åŽŸå­åŒ–ï¼ˆðŸ”§ åˆ¶å¤‡ / ðŸ“Š è¡¨å¾ / âš¡ æ€§èƒ½ / ðŸ”¬ æœºåˆ¶ / âœ¨ ç†è®ºï¼‰
8. ðŸ¤” æ€è€ƒï¼ˆä¼˜ç¼ºç‚¹åˆ†æžã€ç–‘é—®ä¸Žäº‰è®®ã€ç ”ç©¶å¯å‘ã€è®ºè¯é€»è¾‘é“¾è·¯å›¾ï¼‰
9. ðŸª¸ é‡ç»„åˆ†å­åŒ–ï¼ˆé€»è¾‘é“¾å®Œæ•´æ€§ã€æ•°æ®å¯ä¿¡åº¦ã€ç»“è®ºåˆç†æ€§ï¼‰
10. ðŸ§® ä¸¥æ ¼è¯„åˆ†

---

## JSON æ ¼å¼è§„åˆ™ï¼ˆå¿…é¡»éµå®ˆï¼‰

1. é¡¶å±‚æ ¼å¼ï¼š`{"sections": [...]}`
2. å…è®¸çš„ block typeï¼š
   - `{"type":"heading","level":2|3|4,"text":"..."}`
   - `{"type":"paragraph","text":"..."}`
   - `{"type":"bullet_list","items":[{"text":"..."}]}`
   - `{"type":"table","headers":[...],"rows":[[...]]}`
   - `{"type":"hr"}`
3. å­—æ®µåå¿…é¡»ä½¿ç”¨ `text`ï¼Œä¸è¦ä½¿ç”¨ `content`ã€‚
4. `ç¬”è®°åŽŸå­åŒ–` å…è®¸åœ¨ bullet item ä¸­ä½¿ç”¨ `citations`ï¼š
   - `{"text":"...","citations":[{"location":"...","content":"..."}]}`
5. é™¤ `ç¬”è®°åŽŸå­åŒ–` å¤–ï¼Œå…¶ä»–éƒ¨åˆ†ä¸è¦ä½¿ç”¨ `citations` å­—æ®µã€‚
6. å¿…é¡»åªè¾“å‡ºä¸€ä¸ª ```json ... ``` ä»£ç å—ï¼Œä¸è¦è¾“å‡ºä»£ç å—å¤–è§£é‡Šæ–‡å­—ã€‚
7. `ðŸ¤” æ€è€ƒ` å¿…é¡»åŒ…å« 4 ä¸ªå››çº§å­æ ‡é¢˜ï¼š`ä¼˜ç¼ºç‚¹åˆ†æž`ã€`ç–‘é—®ä¸Žäº‰è®®`ã€`ç ”ç©¶å¯å‘`ã€`è®ºè¯é€»è¾‘é“¾è·¯å›¾`ã€‚
8. `ç ”ç©¶å¯å‘` æ ‡é¢˜åŽå¿…é¡»ç´§è·Ÿä¸€ä¸ª `bullet_list`ï¼Œä¸” `items` è‡³å°‘ 3 æ¡ï¼Œä¸å¾—ä¸ºç©ºã€‚
9. è‹¥è¯æ®ä¸è¶³ï¼Œ`ç ”ç©¶å¯å‘` çš„æ¡ç›®ä¸­å¿…é¡»æ˜Žç¡®å†™å‡ºâ€œæœ¬æ–‡æœªæ¶‰åŠâ€æˆ–â€œè¯æ®ä¸è¶³â€ã€‚

### JSON è¾“å‡ºæ ¼å¼ç¤ºä¾‹ï¼š

```json
{{
  "sections": [
    {{"type": "heading", "level": 3, "text": "ðŸ“– ç²—è¯»ç­›é€‰"}},
    {{"type": "paragraph", "text": "è¯·ä»Žä»¥ä¸‹ç»´åº¦å¿«é€Ÿè¯„ä¼°è¿™ç¯‡è®ºæ–‡çš„è´¨é‡å’Œé˜…è¯»ä»·å€¼ï¼š"}},
    {{"type": "bullet_list", "items": [
      {{"text": "æœŸåˆŠå½±å“åŠ›ï¼šå‘è¡¨åœ¨é¡¶çº§æœŸåˆŠ"}},
      {{"text": "ç ”ç©¶é—®é¢˜é‡è¦æ€§ï¼šèšç„¦å…³é”®ç§‘å­¦é—®é¢˜"}}
    ]}},

    {{"type": "hr"}},

    {{"type": "heading", "level": 3, "text": "âœ¨ ç¬”è®°åŽŸå­åŒ–"}},
    {{"type": "paragraph", "text": "ä»¥ä¸‹éƒ¨åˆ†æå–å…·ä½“æ•°æ®ï¼Œ**æ¯æ¡æ•°æ®å¿…é¡»åŒ…å«åŽŸæ–‡å¼•ç”¨**ï¼š"}},
    {{"type": "heading", "level": 4, "text": "ðŸ”§ åˆ¶å¤‡"}},
    {{"type": "bullet_list", "items": [
      {{
        "text": "åŽŸæ–™ï¼šå‰é©±ä½“A (99.9%)",
        "citations": [
          {{
            "location": "ç¬¬3æ®µ - æ‰€æœ‰åŒ–å­¦è¯•å‰‚å‡è´­è‡ªSigma-Aldrich",
            "content": "æ‰€æœ‰åŒ–å­¦è¯•å‰‚å‡è´­è‡ªSigma-Aldrichï¼Œä½¿ç”¨å‰æœªç»è¿›ä¸€æ­¥çº¯åŒ–ã€‚å‰é©±ä½“A (99.9%) æº¶äºŽåŽ»ç¦»å­æ°´ä¸­..."
          }}
        ]
      }}
    ]}},

    {{"type": "hr"}},

    {{"type": "heading", "level": 3, "text": "ðŸ¤” æ€è€ƒ"}},
    {{"type": "heading", "level": 4, "text": "ä¼˜ç¼ºç‚¹åˆ†æž"}},
    {{"type": "bullet_list", "items": [
      {{"text": "ä¸»è¦ä¼˜ç‚¹ï¼šå®žéªŒè®¾è®¡ä¸¥è°¨ï¼Œæ•°æ®å¯é "}},
      {{"text": "ä¸»è¦ç¼ºç‚¹ï¼šæ ·æœ¬é‡è¾ƒå°"}}
    ]}},
    {{"type": "heading", "level": 4, "text": "è®ºè¯é€»è¾‘é“¾è·¯å›¾"}},
    {{"type": "paragraph", "text": "æ•´ç¯‡è®ºæ–‡çš„è®ºè¯é€»è¾‘é“¾æ¡å¦‚ä¸‹ï¼š"}},
    {{"type": "bullet_list", "items": [
      {{"text": "[ç ”ç©¶èƒŒæ™¯] çŽ°æœ‰XXææ–™å­˜åœ¨YYé—®é¢˜ â†’ æ–‡çŒ®è¯æ®ï¼šRef.1-5æŠ¥é“äº†..."}},
      {{"text": "â†“"}},
      {{"text": "[æ ¸å¿ƒå‡è®¾] é€šè¿‡AAç­–ç•¥è§£å†³YYé—®é¢˜ â†’ ç†è®ºä¾æ®ï¼šBBç†è®º"}},
      {{"text": "â†“"}},
      {{"text": "[å®žéªŒéªŒè¯1] åˆ¶å¤‡CCææ–™ â†’ ðŸŸ¢ XRDç¡®è®¤ç»“æž„(Fig.2)"}},
      {{"text": "â†“"}},
      {{"text": "[æœºåˆ¶è§£é‡Š] å½’å› äºŽDDæœºåˆ¶ â†’ ðŸŸ¡ åŽŸä½XASæ˜¾ç¤º...(Fig.5)ï¼Œä½†ç¼ºå°‘ç›´æŽ¥è¯æ®"}},
      {{"text": "â†“"}},
      {{"text": "[æœ€ç»ˆç»“è®º] AAç­–ç•¥æœ‰æ•ˆè§£å†³YYé—®é¢˜"}},
      {{"text": "è–„å¼±çŽ¯èŠ‚ï¼šæœºåˆ¶è§£é‡Šç¼ºå°‘ZZæ–¹é¢çš„ç›´æŽ¥è¯æ®"}}
    ]}}
  ]
}}
```

---

## å…³é”®ç¡¬çº¦æŸ

1. **å‚è€ƒæ–‡çŒ®å›ºå®šè¡¨æ ¼**å¿…é¡»å‡ºçŽ°ï¼Œåˆ—åå’Œé¡ºåºå›ºå®šä¸ºï¼š
   - ç¼–å·
   - ç¬¬ä¸€ä½œè€…(å¹´ä»½)
   - æ ‡é¢˜(ç®€å†™)
   - å‘è¡¨æº
   - åœ¨æœ¬æ–‡ä¸­çš„ä½œç”¨
   - å½±å“å¼ºåº¦
   - é‡è¦æ€§è¯„åˆ†(1-5)
   - è¯æ®é”šç‚¹
2. å‚è€ƒæ–‡çŒ®è¡¨æ ¼è¡Œæ•° 3-5 è¡Œï¼Œä¸å¾—è¶…è¿‡ 5 è¡Œï¼›ç¼ºå¤±ä¿¡æ¯å¡«â€œæœªçŸ¥â€ã€‚
3. ä¸¥æ ¼è¯„åˆ†å¿…é¡»åŒ…å« 10 ä¸ªç»´åº¦ï¼ˆæ¯é¡¹ 0-10ï¼‰+ æ€»åˆ†ï¼ˆ0-100ï¼‰+ è¯„çº§ï¼ˆA/B/C/Dï¼‰+ ä¸€å¥è¯ç»“è®ºã€‚
4. å…³é”®åˆ¤æ–­å¿…é¡»å°½é‡å¸¦è¯æ®é”šç‚¹ï¼ˆé¡µç /å›¾å·/è¡¨å·/å‚è€ƒæ–‡çŒ®ç¼–å·ï¼‰ã€‚
5. è‹¥æœ‰æå–ç¼ºå¤±æˆ– OCR é—®é¢˜ï¼Œæ˜Žç¡®å†™â€œè§£æžé£Žé™©æç¤ºâ€ã€‚
6. `ç ”ç©¶å¯å‘` å°èŠ‚ä¸å¾—ä¸ºç©ºï¼Œä¸”è‡³å°‘åŒ…å« 3 æ¡å¯æ‰§è¡Œè¦ç‚¹ã€‚

---

## JSON è¾“å‡ºç¤ºä¾‹ï¼ˆç®€åŒ–ï¼‰

```json
{
  "sections": [
    {"type": "heading", "level": 3, "text": "ðŸ§­ é˜…è¯»åè®®ï¼ˆå…ˆæ‰§è¡Œï¼‰"},
    {"type": "bullet_list", "items": [
      {"text": "æ–‡æœ¬å¯è¯»æ€§ï¼šåŸºæœ¬å®Œæ•´ï¼Œå°‘é‡OCRå™ªå£°ï¼ˆç¬¬9é¡µï¼‰"},
      {"text": "è¯æ®ä¼˜å…ˆçº§ï¼šå›¾è¡¨>æ­£æ–‡>æŽ¨æ–­"}
    ]},
    {"type": "heading", "level": 3, "text": "ðŸ“Ž å‚è€ƒæ–‡çŒ®"},
    {"type": "table", "headers": ["ç¼–å·", "ç¬¬ä¸€ä½œè€…(å¹´ä»½)", "æ ‡é¢˜(ç®€å†™)", "å‘è¡¨æº", "åœ¨æœ¬æ–‡ä¸­çš„ä½œç”¨", "å½±å“å¼ºåº¦", "é‡è¦æ€§è¯„åˆ†(1-5)", "è¯æ®é”šç‚¹"], "rows": [
      ["[12]", "Smith (2021)", "Example title", "Nature", "æ–¹æ³•æ¥æº", "é«˜", "5", "ç¬¬4é¡µï¼Œ[12]é™„è¿‘æ®µè½"],
      ["[18]", "Lee (2023)", "Example title 2", "Science", "å¯¹æ¯”åŸºçº¿", "ä¸­", "4", "ç¬¬6é¡µï¼Œ[18]é™„è¿‘æ®µè½"],
      ["æœªçŸ¥", "Wang (2019)", "Example title 3", "JACS", "æœºåˆ¶æ”¯æŒ", "ä¸­", "4", "ç¬¬8é¡µï¼Œæœºåˆ¶è®¨è®ºæ®µ"]
    ]},
    {"type": "paragraph", "text": "æ ¸å¿ƒæ–‡çŒ®è„‰ç»œæ€»ç»“ï¼šå…ˆç”±[12]æä¾›æ–¹æ³•æ¡†æž¶ï¼Œå†ç”±[18]æä¾›å¯¹æ¯”åŸºçº¿ï¼Œç»“åˆWang(2019)æ”¯æŒæœºåˆ¶æŽ¨æ–­ã€‚"},
    {"type": "heading", "level": 3, "text": "ðŸ§® ä¸¥æ ¼è¯„åˆ†ï¼ˆå¿…é¡»è¾“å‡ºï¼‰"},
    {"type": "table", "headers": ["è¯„åˆ†ç»´åº¦", "åˆ†æ•°(0-10)", "è¯æ®é”šç‚¹", "æ‰£åˆ†åŽŸå› "], "rows": [
      ["é—®é¢˜é‡è¦æ€§ä¸Žå‰æ²¿æ€§", "8.5", "ç¬¬1é¡µ/å‚è€ƒæ–‡çŒ®[3]", "åº”ç”¨åœºæ™¯ä»åçª„"],
      ["æ–¹æ³•è®¾è®¡ä¸¥è°¨æ€§", "8.0", "ç¬¬3é¡µ/è¡¨2", "ç¼ºå°‘æ›´å¼ºæ¶ˆèžå¯¹ç…§"]
    ]},
    {"type": "paragraph", "text": "æ€»åˆ†ï¼ˆ0-100ï¼‰ï¼š81.0ï¼›è¯„çº§ï¼šBï¼›ä¸€å¥è¯ç»“è®ºï¼šå»ºè®®çº³å…¥æ ¸å¿ƒé˜…è¯»æ¸…å•ï¼Œæ–¹æ³•å¯å¤çŽ°æ€§è¾ƒå¥½ä½†å¤–æŽ¨ä»éœ€éªŒè¯ã€‚"}
  ]
}
```

---

**è¾“å‡ºè¦æ±‚**ï¼š
- ä½¿ç”¨ markdown ä»£ç å—ï¼š```json ... ```
- ç¡®ä¿ JSON å®Œæ•´ä¸”æœ‰æ•ˆ
- æŽ§åˆ¶æ€»é•¿åº¦åœ¨ 8192 tokens å†…
"""


DEFAULT_ANALYSIS_TEMPLATE_MULTIMODAL = """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ç§‘ç ”æ–‡çŒ®å¤šæ¨¡æ€åˆ†æžåŠ©æ‰‹ã€‚è¯·ç»¼åˆ PDF ä¸­çš„æ–‡æœ¬ã€è¡¨æ ¼ã€å›¾ç‰‡ã€æ‰¹æ³¨ã€å‚è€ƒæ–‡çŒ®ä¸Žç‰ˆå¼ä¿¡æ¯ï¼Œè¿›è¡Œè¯æ®é©±åŠ¨ã€å¯è¿½è¸ªçš„æ·±åº¦åˆ†æžã€‚

## è®ºæ–‡åŸºæœ¬ä¿¡æ¯

- **æ ‡é¢˜**: {title}
- **ä½œè€…**: {authors}
- **æœŸåˆŠ**: {journal}
- **å‘è¡¨æ—¥æœŸ**: {date}
- **DOI**: {doi}

## è®ºæ–‡å…¨æ–‡

{fulltext}

{annotations_section}

{multimodal_section}

---

## åˆ†æžè¦æ±‚

è¯·æŒ‰ä»¥ä¸‹ç»“æž„è¾“å‡º Markdownï¼Œå¹¶ç¡®ä¿æ¯ä¸ªå…³é”®ç»“è®ºéƒ½å°½é‡ç»‘å®šæ¥æºé”šç‚¹ï¼ˆå¦‚ï¼šç¬¬12é¡µã€å›¾ç‰‡3ã€è¡¨æ ¼2ã€å‚è€ƒæ–‡çŒ®[15]ï¼‰ã€‚

### ðŸ§­ å¤šæ¨¡æ€é˜…è¯»åè®®ï¼ˆå…ˆæ‰§è¡Œï¼‰

- å…ˆåˆ¤æ–­æ–‡æœ¬å¯è¯»æ€§ï¼šæ­£æ–‡æ˜¯å¦å®Œæ•´ã€æ˜¯å¦å­˜åœ¨ OCR é”™æ¼æˆ–æ®µè½æ–­è£‚ã€‚
- å»ºç«‹é¡µé¢ä¸Žç‰ˆå¼åœ°å›¾ï¼šæ ‡é¢˜å±‚çº§ã€åŒæ /å•æ ã€å›¾è¡¨ä¸Žæ­£æ–‡é‚»æŽ¥å…³ç³»ã€è¡¥å……ææ–™ä½ç½®ã€‚
- æ˜Žç¡®è¯æ®ç±»åž‹ï¼šæ­£æ–‡è¯æ®ã€å›¾åƒè¯æ®ã€è¡¨æ ¼è¯æ®ã€å‚è€ƒæ–‡çŒ®è¯æ®ã€æ‰¹æ³¨è¯æ®ã€‚
- è‹¥ä¿¡æ¯å†²çªï¼ŒæŒ‰â€œåŽŸå§‹æ•°æ®/å›¾è¡¨ > æ­£æ–‡æè¿° > æŽ¨æ–­â€æŽ’åºå¹¶è§£é‡ŠåŽŸå› ã€‚

### ðŸ“– ç²—è¯»ç­›é€‰

è¯·ä»Žä»¥ä¸‹ç»´åº¦å¿«é€Ÿè¯„ä¼°è¿™ç¯‡è®ºæ–‡çš„è´¨é‡å’Œé˜…è¯»ä»·å€¼ï¼š
- è®ºæ–‡å‘è¡¨æœŸåˆŠçš„å½±å“åŠ›å’Œé¢†åŸŸåœ°ä½
- ç ”ç©¶é—®é¢˜çš„é‡è¦æ€§å’Œå‰æ²¿æ€§
- æ–¹æ³•å’Œç»“è®ºçš„å¯é æ€§å’Œåˆ›æ–°æ€§
- **ç»“è®º**: æ˜¯å¦å»ºè®®æ·±å…¥é˜…è¯»ï¼Ÿé€‚åˆå“ªç±»ç ”ç©¶è€…ï¼Ÿ

### ðŸ§© PDFç‰ˆå¼ä¸Žä¿¡æ¯æž¶æž„åˆ†æž

- è®ºæ–‡ç»“æž„æ˜¯å¦è§„èŒƒï¼ˆæ‘˜è¦-å¼•è¨€-æ–¹æ³•-ç»“æžœ-è®¨è®º-ç»“è®ºï¼‰ï¼Ÿ
- ç‰ˆå¼æ˜¯å¦å½±å“ç†è§£ï¼ˆè·¨é¡µæ–­å¥ã€å›¾æ³¨ä¸Žæ­£æ–‡é”™ä½ã€è¡¨æ ¼åˆ†é¡µï¼‰ï¼Ÿ
- å…³é”®è®ºæ®æ˜¯å¦å‡ºçŽ°åœ¨æ­£æ–‡ä¸»ä½“è¿˜æ˜¯è¡¥å……ä¿¡æ¯ä¸­ï¼Ÿ
- æ˜¯å¦å­˜åœ¨â€œç»“è®ºåœ¨æ­£æ–‡ï¼Œä½†å…³é”®è¯æ®åªåœ¨å›¾æ³¨/é™„å½•â€çš„æƒ…å†µï¼Ÿ

### ðŸ“š å‰è¨€åŠæ–‡çŒ®ç»¼è¿°

#### å¼•ç”¨æ–‡çŒ®è¯„ä¼°
- å¼•ç”¨çš„æ–‡çŒ®æ˜¯å¦**æœ€æ–°**ã€**å…¨é¢**ï¼Ÿ
- ä»¥å¾€æ–‡çŒ®æœ‰ä»€ä¹ˆ**ä¸è¶³**æˆ–**ç ”ç©¶ç©ºç™½**ï¼Ÿ
- ä½œè€…å¦‚ä½•å®šä½æœ¬ç ”ç©¶ä¸Žå‰äººå·¥ä½œçš„å…³ç³»ï¼Ÿ

#### èšç„¦é—®é¢˜
- æœ¬ç ”ç©¶**èšç„¦çš„æ ¸å¿ƒç§‘å­¦é—®é¢˜**æ˜¯ä»€ä¹ˆï¼Ÿ
- ç ”ç©¶çš„**é€»è¾‘æ€è·¯**æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆé—®é¢˜ -> å‡è®¾ -> æ–¹æ³• -> è¯æ® -> ç»“è®ºï¼‰ï¼Ÿ
- **å¯è¡Œæ€§**ï¼šæ–¹æ³•è®¾è®¡æ˜¯å¦åˆç†ï¼ŸæŠ€æœ¯è·¯çº¿æ˜¯å¦å¯è¡Œï¼Ÿ
- **å¯é æ€§**ï¼šå®žéªŒè®¾è®¡æ˜¯å¦ä¸¥è°¨ï¼Ÿå¯¹ç…§ç»„è®¾ç½®æ˜¯å¦åˆç†ï¼Ÿ

#### é€‰é¢˜æ–°é¢–æ€§
- ä½œè€…é€‰é¢˜è§’åº¦æ˜¯å¦**æ–°é¢–**ï¼Ÿ
- è¿™é¡¹ç ”ç©¶æœ‰ä»€ä¹ˆ**ç§‘å­¦ä»·å€¼**å’Œ**åº”ç”¨å‰æ™¯**ï¼Ÿ

### ðŸ“Ž å‚è€ƒæ–‡çŒ®

è¯·ä¼˜å…ˆä»Žè®ºæ–‡æœ«å°¾ References/Bibliography éƒ¨åˆ†æå–â€œæœ€é‡è¦æ–‡çŒ®â€ï¼Œå¹¶ç»“åˆæ­£æ–‡å¼•ç”¨è¯­å¢ƒåˆ¤æ–­å…¶ä»·å€¼ã€‚

æå–è§„åˆ™ï¼š
- ä¼˜å…ˆä¿ç•™å¯¹æœ¬æ–‡æ–¹æ³•ã€ç†è®ºã€æ•°æ®å¯¹æ¯”ç›´æŽ¥ç›¸å…³çš„æ–‡çŒ®ã€‚
- åŒç±»æ–‡çŒ®åŽ»é‡ï¼Œä¿ç•™ä»£è¡¨æ€§å·¥ä½œï¼ˆç»å…¸å¥ åŸº + æœ€æ–°è¿›å±•ï¼‰ã€‚
- è‹¥æ­£æ–‡ä¸Žå‚è€ƒæ–‡çŒ®ç¼–å·å­˜åœ¨æ˜ å°„ï¼ˆå¦‚ [12], [35]ï¼‰ï¼Œå°½é‡ä¿ç•™è¯¥ç¼–å·ã€‚
- è‹¥ PDF å‚è€ƒæ–‡çŒ®æå–ä¸å®Œæ•´ï¼ˆOCR/åˆ†é¡µé—®é¢˜ï¼‰ï¼Œæ˜Žç¡®æ ‡è®°â€œæå–ä¸å®Œæ•´â€ã€‚

è¯·ä»¥å›ºå®š Markdown è¡¨æ ¼è¾“å‡ºâ€œé‡è¦å‚è€ƒæ–‡çŒ®æ¸…å•â€ï¼ˆ3-5 ç¯‡ï¼Œä¸è¦è¶…è¿‡ 5 ç¯‡ï¼‰ï¼š

| ç¼–å· | ç¬¬ä¸€ä½œè€…(å¹´ä»½) | æ ‡é¢˜(ç®€å†™) | å‘è¡¨æº | åœ¨æœ¬æ–‡ä¸­çš„ä½œç”¨ | å½±å“å¼ºåº¦ | é‡è¦æ€§è¯„åˆ†(1-5) | è¯æ®é”šç‚¹ |
|---|---|---|---|---|---|---:|---|
| [12] | Smith (2021) | Example title | Nature | æ–¹æ³•æ¥æº | é«˜ | 5 | ç¬¬4é¡µï¼Œ[12]é™„è¿‘æ®µè½ |

è¡¨æ ¼æ ¼å¼è§„åˆ™ï¼š
- å¿…é¡»ä¿æŒä¸Šè¿°åˆ—é¡ºåºå’Œè¡¨å¤´ï¼Œä¸å¾—æ–°å¢žæˆ–åˆ é™¤åˆ—ã€‚
- æ•°æ®è¡Œæœ€å°‘ 3 è¡Œï¼Œæœ€å¤š 5 è¡Œã€‚
- ä¿¡æ¯ç¼ºå¤±æ—¶å¡«å†™â€œæœªçŸ¥â€ï¼Œä¸å¾—ç•™ç©ºã€‚
- è¡¨æ ¼åŽè¿½åŠ  2-3 å¥â€œæ ¸å¿ƒæ–‡çŒ®è„‰ç»œæ€»ç»“â€ã€‚

### ðŸ’¡ åˆ›æ–°ç‚¹

è¯·ä»Žä»¥ä¸‹äº”ä¸ªç»´åº¦åˆ†æžåˆ›æ–°ç‚¹ï¼š

#### ç§‘å­¦é—®é¢˜
- æå‡ºäº†ä»€ä¹ˆæ–°çš„ç§‘å­¦é—®é¢˜æˆ–ç ”ç©¶è§†è§’ï¼Ÿ

#### åˆ¶å¤‡æ–¹æ³•
- åœ¨ææ–™åˆ¶å¤‡æˆ–æ ·å“å‡†å¤‡ä¸Šæœ‰ä»€ä¹ˆåˆ›æ–°ï¼Ÿ
- æ˜¯å¦å¼€å‘äº†æ–°çš„åˆæˆè·¯çº¿æˆ–å·¥è‰ºï¼Ÿ

#### ç ”ç©¶æ€è·¯
- ç ”ç©¶è®¾è®¡æœ‰ä½•ç‹¬ç‰¹ä¹‹å¤„ï¼Ÿ
- æ˜¯å¦é‡‡ç”¨äº†æ–°çš„ç ”ç©¶èŒƒå¼æˆ–ç­–ç•¥ï¼Ÿ

#### ç ”ç©¶å·¥å…·
- ä½¿ç”¨äº†ä»€ä¹ˆæ–°çš„ç ”ç©¶å·¥å…·ã€æŠ€æœ¯æˆ–è¡¨å¾æ‰‹æ®µï¼Ÿ
- æ˜¯å¦å¼€å‘äº†æ–°çš„æµ‹è¯•æ–¹æ³•æˆ–åˆ†æžæ‰‹æ®µï¼Ÿ

#### ç ”ç©¶ç†è®º
- åœ¨ç†è®ºå±‚é¢æœ‰ä½•è´¡çŒ®ï¼Ÿ
- æ˜¯å¦æå‡ºäº†æ–°çš„æ¨¡åž‹ã€æœºåˆ¶è§£é‡Šæˆ–ç†è®ºæ¡†æž¶ï¼Ÿ

### ðŸ–¼ï¸ å›¾åƒè¯æ®åˆ†æž

{figure_analysis_section}

é’ˆå¯¹æ¯å¼ å…³é”®å›¾ç‰‡ï¼Œè¯·è¡¥å……ï¼š
- å›¾åƒç±»åž‹ï¼ˆæ˜¾å¾®å›¾ã€è°±å›¾ã€æµç¨‹å›¾ã€ç¤ºæ„å›¾ã€ç…§ç‰‡ç­‰ï¼‰
- å›¾åƒæ‰¿è½½çš„æ ¸å¿ƒè®ºç‚¹ä¸Žå¯¹åº”ç»“è®º
- å›¾åƒæ˜¯å¦å­˜åœ¨è§£é‡Šæ­§ä¹‰ã€å°ºåº¦ä¸ä¸€è‡´ã€å¯¹æ¯”ä¸å…¬å¹³
- å›¾åƒä¸Žæ­£æ–‡ç»“è®ºæ˜¯å¦ä¸€è‡´

### ðŸ“‹ è¡¨æ ¼è¯æ®åˆ†æž

{table_analysis_section}

é’ˆå¯¹æ¯ä¸ªå…³é”®è¡¨æ ¼ï¼Œè¯·è¡¥å……ï¼š
- å­—æ®µå®šä¹‰æ˜¯å¦æ¸…æ™°ï¼ˆå˜é‡ã€å•ä½ã€æ ·æœ¬é‡ã€ç»Ÿè®¡å£å¾„ï¼‰
- å…³é”®æ•°å€¼ã€è¶‹åŠ¿ã€æžå€¼ã€å¼‚å¸¸å€¼
- ä¸Žå¯¹ç…§ç»„/åŸºçº¿/æ–‡çŒ®å€¼ç›¸æ¯”çš„æ”¹è¿›å¹…åº¦
- è¡¨æ ¼ç»“è®ºä¸Žæ­£æ–‡å™è¿°æ˜¯å¦ä¸€è‡´

### ðŸ”„ è·¨æ¨¡æ€ä¸€è‡´æ€§æ ¸éªŒ

- æ­£æ–‡ç»“è®ºæ˜¯å¦è¢«å›¾åƒå’Œè¡¨æ ¼å…±åŒæ”¯æŒï¼Ÿ
- æ˜¯å¦å­˜åœ¨â€œå›¾è¡¨æ˜¾ç¤º Aï¼Œæ­£æ–‡å†™æˆ Bâ€çš„çŸ›ç›¾ï¼Ÿ
- æœºåˆ¶è§£é‡Šæ˜¯å¦åŒæ—¶å¾—åˆ°æ–‡å­—è®ºè¯ä¸Žå®žéªŒå›¾è¡¨æ”¯æŒï¼Ÿ
- è‹¥å‡ºçŽ°å†²çªï¼Œç»™å‡ºæœ€å¯ä¿¡è§£é‡Šä¸Žä¸ç¡®å®šæ€§è¯´æ˜Žã€‚

### ðŸ“ ç¬”è®°åŽŸå­åŒ–

ä»¥ä¸‹éƒ¨åˆ†è¯·**æå–å…·ä½“æ•°æ®å’Œå…³é”®ä¿¡æ¯**ï¼Œä¾¿äºŽåŽç»­å¼•ç”¨ï¼š

#### ðŸ”§ åˆ¶å¤‡
- **åŽŸæ–™/å‰é©±ä½“**: åˆ—å‡ºå…³é”®ææ–™å’ŒåŒ–å­¦è¯•å‰‚
- **åˆ¶å¤‡æ­¥éª¤**: ç®€è¦æè¿°æ ¸å¿ƒå·¥è‰ºæµç¨‹ï¼ˆæ¸©åº¦ã€æ—¶é—´ã€æ°”æ°›ç­‰å…³é”®å‚æ•°ï¼‰
- **å…³é”®æ¡ä»¶**: å½±å“ç»“æžœçš„å…³é”®å®žéªŒæ¡ä»¶

#### ðŸ“Š è¡¨å¾
- **è¡¨å¾æ–¹æ³•**: ä½¿ç”¨äº†å“ªäº›è¡¨å¾æŠ€æœ¯ï¼Ÿï¼ˆXRD, SEM, TEM, XPS, BETç­‰ï¼‰
- **ä¸»è¦ç»“æžœ**: æ¯ç§è¡¨å¾æ–¹æ³•å¾—åˆ°çš„å…³é”®ç»“è®º
- **æ•°æ®æ”¯æŒ**: æå–å…³é”®çš„æ•°å€¼æ•°æ®ï¼ˆå¦‚æ™¶æ ¼å¸¸æ•°ã€ç²’å¾„ã€æ¯”è¡¨é¢ç§¯ç­‰ï¼‰

#### âš¡ æ€§èƒ½
- **æ€§èƒ½æŒ‡æ ‡**: åˆ—å‡ºå…³é”®æ€§èƒ½å‚æ•°ï¼ˆå¦‚æ´»æ€§ã€é€‰æ‹©æ€§ã€ç¨³å®šæ€§ã€æ•ˆçŽ‡ç­‰ï¼‰
- **å…·ä½“æ•°å€¼**: æå–å‡†ç¡®çš„æ•°å€¼å’Œå•ä½
- **å¯¹æ¯”åŸºå‡†**: ä¸Žæ–‡çŒ®æŠ¥é“æˆ–å•†ä¸šæ ‡å‡†çš„å¯¹æ¯”ç»“æžœ
- **ä¼˜åŠ¿ä½“çŽ°**: æ€§èƒ½ä¼˜åŠ¿ä½“çŽ°åœ¨å“ªäº›æ–¹é¢ï¼Ÿ

#### ðŸ”¬ æœºåˆ¶
- **æœºåˆ¶å‡è®¾**: ä½œè€…æå‡ºçš„ååº”æœºåˆ¶æˆ–ä½œç”¨æœºç†
- **è¯æ®æ”¯æŒ**: å“ªäº›å®žéªŒæ•°æ®æˆ–è¡¨å¾ç»“æžœæ”¯æŒè¿™ä¸€æœºåˆ¶ï¼Ÿ
- **å…³é”®æ­¥éª¤**: æœºåˆ¶ä¸­çš„å…³é”®ååº”æ­¥éª¤æˆ–ç‰©ç†åŒ–å­¦è¿‡ç¨‹
- **äº‰è®®ç‚¹**: æ˜¯å¦å­˜åœ¨å…¶ä»–å¯èƒ½çš„æœºåˆ¶è§£é‡Šï¼Ÿ

#### âœ¨ ç†è®º
- **ç†è®ºæ¨¡åž‹**: ä½¿ç”¨æˆ–å»ºç«‹äº†ä»€ä¹ˆç†è®ºæ¨¡åž‹ï¼Ÿ
- **è®¡ç®—æ–¹æ³•**: å¦‚æ¶‰åŠç†è®ºè®¡ç®—ï¼Œä½¿ç”¨äº†ä»€ä¹ˆæ–¹æ³•ï¼Ÿï¼ˆDFT, MDç­‰ï¼‰
- **ç†è®ºé¢„æµ‹**: ç†è®ºè®¡ç®—æˆ–æ¨¡åž‹é¢„æµ‹äº†ä»€ä¹ˆï¼Ÿ
- **å®žéªŒéªŒè¯**: ç†è®ºé¢„æµ‹æ˜¯å¦å¾—åˆ°å®žéªŒéªŒè¯ï¼Ÿ

---

### ðŸ¤” æ€è€ƒ

#### ä¼˜ç¼ºç‚¹åˆ†æž
- **ä¸»è¦ä¼˜ç‚¹**: è¿™ç¯‡è®ºæ–‡çš„çªå‡ºè´¡çŒ®ï¼ˆè‡³å°‘3ç‚¹ï¼‰
- **ä¸»è¦ç¼ºç‚¹**: å­˜åœ¨çš„é—®é¢˜æˆ–ä¸è¶³ï¼ˆè‡³å°‘2ç‚¹ï¼‰
  - å®žéªŒè®¾è®¡çš„å±€é™æ€§
  - æ•°æ®å®Œæ•´æ€§æˆ–è¯´æœåŠ›çš„æ¬ ç¼º
  - æœºåˆ¶è§£é‡Šçš„ä¸è¶³æˆ–äº‰è®®

#### ç–‘é—®ä¸Žäº‰è®®
- ä½ å¯¹å“ªäº›å†…å®¹äº§ç”Ÿäº†ç–‘é—®ï¼Ÿ
- å“ªäº›ç»“è®ºçš„å¯é æ€§éœ€è¦è¿›ä¸€æ­¥éªŒè¯ï¼Ÿ
- æ˜¯å¦å­˜åœ¨æ›¿ä»£æ€§è§£é‡Šæˆ–äº‰è®®æ€§è§‚ç‚¹ï¼Ÿ

#### ç ”ç©¶å¯å‘
- è¿™ç¯‡è®ºæ–‡ç»™ä½ å¸¦æ¥äº†ä»€ä¹ˆç ”ç©¶å¯å‘ï¼Ÿ
- å¯ä»¥å¦‚ä½•æ”¹è¿›æˆ–æ‰©å±•è¿™é¡¹å·¥ä½œï¼Ÿ
- å¯¹ä½ è‡ªå·±çš„ç ”ç©¶æœ‰ä»€ä¹ˆå€Ÿé‰´æ„ä¹‰ï¼Ÿ
- è¾“å‡ºè¦æ±‚ï¼šè‡³å°‘ç»™å‡º 3 æ¡å¯æ‰§è¡Œå¯å‘ï¼Œåˆ†åˆ«è¦†ç›–ï¼š
  1) å¯è¿ç§»çš„æ–¹æ³•/ç»“è®ºï¼›
  2) å¯éªŒè¯çš„æ”¹è¿›æˆ–æ‰©å±•å®žéªŒï¼›
  3) å¯¹ä½ å½“å‰ç ”ç©¶æ–¹å‘çš„ä¸‹ä¸€æ­¥è¡ŒåŠ¨ã€‚
- è‹¥è¯æ®ä¸è¶³ï¼Œä¸å¾—ç•™ç©ºï¼›æ˜Žç¡®å†™â€œæœ¬æ–‡æœªæ¶‰åŠâ€æˆ–â€œè¯æ®ä¸è¶³ï¼ˆéœ€è¡¥å……XXæ•°æ®ï¼‰â€ã€‚
#### è®ºè¯é€»è¾‘é“¾è·¯å›¾

è¯·æ¢³ç†æ•´ç¯‡æ–‡ç« çš„**å®Œæ•´è®ºè¯é€»è¾‘é“¾æ¡**ï¼Œé€æ­¥æ‹†è§£ä»Žç ”ç©¶é—®é¢˜åˆ°æœ€ç»ˆç»“è®ºçš„æŽ¨ç†è¿‡ç¨‹ã€‚æ¯ä¸€æ­¥éœ€åŒ…å«**è®ºæ®**ï¼ˆä½œè€…çš„ä¸»å¼ ï¼‰å’Œ**è¯æ®**ï¼ˆæ”¯æŒè¯¥ä¸»å¼ çš„å®žéªŒæ•°æ®ã€è¡¨å¾ç»“æžœæˆ–æ–‡çŒ®ä¾æ®ï¼‰ï¼Œå¹¶æ ‡æ³¨è¯æ®å¼ºå¼±ã€‚

**æ ¼å¼è¦æ±‚**ï¼šç”¨ä»¥ä¸‹é“¾è·¯å›¾æ ¼å¼ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«è®ºæ®å’Œè¯æ®ï¼š

- **[ç ”ç©¶èƒŒæ™¯/åŠ¨æœº]** çŽ°æœ‰é—®é¢˜æˆ–ç ”ç©¶ç©ºç™½ â†’ æ–‡çŒ®è¯æ®æ”¯æŒ
- â†“
- **[æ ¸å¿ƒå‡è®¾]** ä½œè€…æå‡ºçš„è§£å†³ç­–ç•¥ â†’ ç†è®ºä¾æ®æˆ–å‰æœŸå·¥ä½œ
- â†“
- **[å®žéªŒéªŒè¯ N]** å…³é”®å®žéªŒåŠç»“æžœ â†’ ðŸŸ¢/ðŸŸ¡/ðŸ”´ å…·ä½“æ•°æ®è¯æ®ï¼ˆæ ‡æ³¨å›¾è¡¨ç¼–å·ï¼‰
- â†“
- **[æœºåˆ¶è§£é‡Š]** ä½œè€…çš„æœºåˆ¶æŽ¨æ–­ â†’ è¯æ®åŠå…¶å……åˆ†ç¨‹åº¦
- â†“
- **[æœ€ç»ˆç»“è®º]** æœ‰æ•ˆç»“è®ºä¸Žé€‚ç”¨è¾¹ç•Œ


**è¯æ®å¼ºå¼±æ ‡æ³¨**ï¼šðŸŸ¢ å¼ºè¯æ®ï¼ˆç›´æŽ¥æ•°æ®æ”¯æŒï¼‰/ ðŸŸ¡ ä¸­ç­‰è¯æ®ï¼ˆé—´æŽ¥æŽ¨æ–­ï¼‰/ ðŸ”´ å¼±è¯æ®ï¼ˆç¼ºä¹å……åˆ†æ”¯æŒï¼‰

- å¦‚æœ‰**å¤šæ¡å¹¶è¡Œè®ºè¯çº¿ç´¢**ï¼Œè¯·åˆ†åˆ«åˆ—å‡ºæ¯æ¡é“¾è·¯
- æ˜Žç¡®æŒ‡å‡ºé€»è¾‘é“¾ä¸­çš„**è–„å¼±çŽ¯èŠ‚**ï¼ˆè¯æ®ä¸è¶³ã€é€»è¾‘è·³è·ƒã€æ›¿ä»£è§£é‡Šï¼‰

---

### è¯„åˆ†

è¯·ç»™å‡º 0-100 çš„æ€»åˆ†ï¼Œå¹¶æŒ‰ä¸‹åˆ—ç»´åº¦é€é¡¹æ‰“åˆ†ï¼ˆæ¯é¡¹ 0-10 åˆ†ï¼‰ï¼š

- é—®é¢˜é‡è¦æ€§ä¸Žå‰æ²¿æ€§
- æ–¹æ³•è®¾è®¡ä¸¥è°¨æ€§
- æ•°æ®ä¸Žç»Ÿè®¡å¯ä¿¡åº¦
- å›¾åƒè¯æ®è´¨é‡
- è¡¨æ ¼è¯æ®è´¨é‡
- è·¨æ¨¡æ€ä¸€è‡´æ€§ï¼ˆæ­£æ–‡/å›¾/è¡¨æ˜¯å¦ä¸€è‡´ï¼‰
- æœºåˆ¶è§£é‡Šå……åˆ†æ€§
- æ–‡çŒ®ç»¼è¿°å®Œæ•´æ€§
- åˆ›æ–°æ€§
- å¯å¤çŽ°æ€§ä¸Žå¯æŽ¨å¹¿æ€§

è¯·ä¸¥æ ¼æŒ‰å¦‚ä¸‹æ ¼å¼è¾“å‡ºè¯„åˆ†ç»“æžœï¼š

| è¯„åˆ†ç»´åº¦ | åˆ†æ•°(0-10) | è¯æ®é”šç‚¹ | æ‰£åˆ†åŽŸå›  |
|---|---:|---|---|
| é—®é¢˜é‡è¦æ€§ä¸Žå‰æ²¿æ€§ | X.X | ç¬¬Xé¡µ/å‚è€ƒæ–‡çŒ®[X] | ... |
| æ–¹æ³•è®¾è®¡ä¸¥è°¨æ€§ | X.X | ç¬¬Xé¡µ/è¡¨X | ... |
| æ•°æ®ä¸Žç»Ÿè®¡å¯ä¿¡åº¦ | X.X | å›¾X/è¡¨X | ... |
| å›¾åƒè¯æ®è´¨é‡ | X.X | å›¾ç‰‡X | ... |
| è¡¨æ ¼è¯æ®è´¨é‡ | X.X | è¡¨æ ¼X | ... |
| è·¨æ¨¡æ€ä¸€è‡´æ€§ | X.X | ç¬¬Xé¡µ/å›¾X/è¡¨X | ... |
| æœºåˆ¶è§£é‡Šå……åˆ†æ€§ | X.X | ç¬¬Xé¡µ/å›¾X | ... |
| æ–‡çŒ®ç»¼è¿°å®Œæ•´æ€§ | X.X | å‚è€ƒæ–‡çŒ®[X-Y] | ... |
| åˆ›æ–°æ€§ | X.X | ç¬¬Xé¡µ | ... |
| å¯å¤çŽ°æ€§ä¸Žå¯æŽ¨å¹¿æ€§ | X.X | ç¬¬Xé¡µ/è¡¥å……ææ–™ | ... |

- **æ€»åˆ†ï¼ˆ0-100ï¼‰**ï¼šXX.X
- **è¯„çº§**ï¼šAï¼ˆ>=85ï¼‰/ Bï¼ˆ70-84ï¼‰/ Cï¼ˆ55-69ï¼‰/ Dï¼ˆ<55ï¼‰
- **ä¸€å¥è¯ç»“è®º**ï¼šæ˜¯å¦å»ºè®®çº³å…¥æ ¸å¿ƒé˜…è¯»æ¸…å•ï¼Œå¹¶è¯´æ˜ŽåŽŸå› ã€‚

---

### ðŸª¸ é‡ç»„åˆ†å­åŒ–ï¼ˆæ·±åº¦æ‰¹åˆ¤æ€§åˆ†æžï¼‰

è¯·å¯¹è®ºæ–‡çš„é€»è¾‘ä¸¥å¯†æ€§è¿›è¡Œæ‰¹åˆ¤æ€§è¯„ä¼°ï¼š

#### é€»è¾‘é“¾å®Œæ•´æ€§
- å›´ç»•æŸä¸€ä¸ªå®žéªŒçŽ°è±¡çš„é€»è¾‘é“¾æ˜¯å¦**å®Œæ•´**ã€**ä»¤äººä¿¡æœ**ï¼Ÿ
  - ä»Žé—®é¢˜æå‡º â†’ å®žéªŒè®¾è®¡ â†’ æ•°æ®å‘ˆçŽ° â†’ ç»“è®ºæŽ¨å¯¼
  - è®ºè¯è¿‡ç¨‹ä¸­æ˜¯å¦å­˜åœ¨**é€»è¾‘ç¼ºçŽ¯**ï¼Ÿ
  - æ˜¯å¦å­˜åœ¨**å…¶ä»–å¯èƒ½çš„è§£é‡Šè§’åº¦**ï¼Ÿ

#### æ•°æ®å¯ä¿¡åº¦
- å®žéªŒæ•°æ®çš„**å¯é‡å¤æ€§**å¦‚ä½•ï¼Ÿ
- å¯¹ç…§å®žéªŒæ˜¯å¦å……åˆ†ï¼Ÿ
- ç»Ÿè®¡åˆ†æžæ˜¯å¦è§„èŒƒï¼Ÿ
- æ•°æ®æ˜¯å¦æ”¯æŒä½œè€…çš„ç»“è®ºï¼Ÿ

#### ç»“è®ºåˆç†æ€§
- ç»“è®ºæ˜¯å¦**è¶…å‡ºæ•°æ®çš„æ”¯æŒèŒƒå›´**ï¼Ÿ
- æ˜¯å¦å­˜åœ¨**è¿‡åº¦è§£è¯»**æˆ–**è¿‡åº¦æŽ¨å¹¿**ï¼Ÿ
- ä½œè€…çš„æŽ¨æµ‹ä¸Žç¡®å‡¿è¯æ®ä¹‹é—´çš„ç•Œé™æ˜¯å¦æ¸…æ™°ï¼Ÿ



## è¾“å‡ºæ ¼å¼è¦æ±‚

1. **ä¿æŒå®¢è§‚ã€ä¸“ä¸šçš„åˆ†æžé£Žæ ¼**ï¼Œé¿å…ä¸»è§‚è‡†æ–­
2. **ä½¿ç”¨ä¸­æ–‡**æ’°å†™åˆ†æžå†…å®¹ï¼Œå…³é”®æœ¯è¯­å¯ç”¨è‹±æ–‡æ ‡æ³¨
3. **æå–å…·ä½“æ•°æ®**ï¼šæ•°å€¼ã€å•ä½ã€æ¡ä»¶ç­‰å…·ä½“ä¿¡æ¯
4. **å¼•ç”¨åŽŸæ–‡**ï¼šé‡è¦ç»“è®ºå¯ä»¥å¼•ç”¨åŽŸæ–‡è¡¨è¿°, 
5. **ç»“è®ºä¼˜å…ˆåŸºäºŽè¯æ®ï¼Œä¸åšæ— ä¾æ®æŽ¨æ–­ã€‚**
6. **æ ‡æ³¨ä¸ç¡®å®šæ€§**ï¼šå¦‚æžœæŸä¸ªéƒ¨åˆ†åœ¨è®ºæ–‡ä¸­æ²¡æœ‰ç›¸å…³å†…å®¹ï¼Œè¯·æ˜Žç¡®æ³¨æ˜Ž"æœ¬æ–‡æœªæ¶‰åŠ"æˆ–"æ•°æ®ä¸è¶³"
7. **ä¿æŒç»“æž„å®Œæ•´**ï¼šå³ä½¿æŸéƒ¨åˆ†å†…å®¹è¾ƒå°‘ï¼Œä¹Ÿè¦ä¿ç•™æ ‡é¢˜ç»“æž„
8. **å›¾ç‰‡å¼•ç”¨**ï¼šåœ¨ç¬”è®°åŽŸå­åŒ–éƒ¨åˆ†å¼•ç”¨å›¾ç‰‡æ—¶ï¼Œä½¿ç”¨"å›¾ç‰‡X"æ ‡æ³¨ï¼ˆXä¸ºå›¾ç‰‡ç¼–å·ï¼‰
9. å¦‚å‘çŽ° PDF æå–è´¨é‡é—®é¢˜ï¼ˆOCR é”™å­—ã€è¡¨æ ¼æ–­è£‚ã€å›¾æ³¨ç¼ºå¤±ï¼‰ï¼Œå•ç‹¬åˆ—å‡ºâ€œè§£æžé£Žé™©æç¤ºâ€ã€‚
10. â€œä¸¥æ ¼è¯„åˆ†â€éƒ¨åˆ†ä¸å¾—çœç•¥ï¼Œä¸”æ¯ä¸ªåˆ†é¡¹éƒ½è¦æœ‰â€œè¯æ®é”šç‚¹ + æ‰£åˆ†åŽŸå› â€ã€‚
11. å¿…é¡»åŒ…å«â€œé‡è¦å‚è€ƒæ–‡çŒ®æ¸…å•â€å›ºå®šè¡¨æ ¼ï¼›è‹¥æ— æ³•å®Œæ•´æå–ï¼Œéœ€è¯´æ˜ŽåŽŸå› å’Œç¼ºå¤±èŒƒå›´ã€‚
12. â€œç ”ç©¶å¯å‘â€å°èŠ‚ä¸å¾—ä¸ºç©ºï¼šè‡³å°‘ 3 æ¡è¦ç‚¹ï¼›è‹¥ä¿¡æ¯ä¸è¶³éœ€æ˜¾å¼å†™â€œæœ¬æ–‡æœªæ¶‰åŠ/è¯æ®ä¸è¶³â€ã€‚



**åˆ†æžç›®æ ‡**: åœ¨å¤šæ¨¡æ€è¯æ®ç»Ÿä¸€æ¡†æž¶ä¸‹ï¼Œæœ€å¤§åŒ–æå–è®ºæ–‡å¯å¤ç”¨ä¿¡æ¯ï¼Œå¹¶æ˜Žç¡®ç»“è®ºå¯ä¿¡åº¦ä¸Žå±€é™ã€‚
"""

# Backward-compatible alias; keep a single template source of truth.
DEFAULT_ANALYSIS_TEMPLATE = DEFAULT_ANALYSIS_TEMPLATE_MULTIMODAL


# -------------------- Theme Configuration --------------------


THEME_PRESETS = {
    "orange-heart": {
        "name": "Typora Orange Heart",
        "primary_color": "rgb(239, 112, 96)",
        "background": "#fff9f9",
        "h2_background": "rgb(239, 112, 96)",
        "h2_color": "#ffffff",
        "link_color": "rgb(239, 112, 96)",
        "code_color": "rgb(239, 112, 96)",
        "code_background": "rgba(27,31,35,0.05)",
        "blockquote_border": "rgb(239, 112, 96)",
        "blockquote_background": "#fff9f9",
        "max_width": "860px",
        "paragraph_margin": "0.2em",
        "list_margin": "0.2em",
        "list_item_margin": "0.2em",
        "h1_margin": "0.8em",
        "h2_margin": "0.8em",
        "h3_margin": "0.6em",
        "h4_margin": "0.6em",
    },
    "default": {
        "name": "Default",
        "primary_color": "#0366d6",
        "background": "#ffffff",
        "h2_background": "#f6f8fa",
        "h2_color": "#24292e",
        "link_color": "#0366d6",
        "code_color": "#0366d6",
        "code_background": "#f6f8fa",
        "blockquote_border": "#dfe2e5",
        "blockquote_background": "#f6f8fa",
        "max_width": "860px",
        "paragraph_margin": "0.8em",
        "list_margin": "1.2em",
        "list_item_margin": "0.4em",
        "h1_margin": "1.5em",
        "h2_margin": "1.5em",
        "h3_margin": "1.3em",
        "h4_margin": "1.2em",
    },
    "minimal": {
        "name": "Minimal",
        "primary_color": "#333333",
        "background": "#ffffff",
        "h2_background": "transparent",
        "h2_color": "#333333",
        "link_color": "#333333",
        "code_color": "#333333",
        "code_background": "#f0f0f0",
        "blockquote_border": "#ddd",
        "blockquote_background": "#ffffff",
        "max_width": "740px",
        "paragraph_margin": "0.6em",
        "list_margin": "1.0em",
        "list_item_margin": "0.3em",
        "h1_margin": "1.2em",
        "h2_margin": "1.2em",
        "h3_margin": "1.0em",
        "h4_margin": "1.0em",
    },
}


# -------------------- Configuration Loading --------------------


def get_analysis_config() -> dict[str, Any]:
    """
    Get AI analysis configuration from environment and config files.

    Returns:
        Dictionary with analysis configuration including:
        - questions: List of analysis questions
        - template: Analysis template string
        - theme: Note theme preset name
        - theme_config: Custom theme configuration (if provided)
    """
    config = load_config()
    env = config.get("env", {})
    analysis_config = config.get("analysis", {})

    # Get questions (priority: env var > config file > default)
    questions_str = env.get("ANALYSIS_QUESTIONS", analysis_config.get("questions", ""))
    if questions_str:
        # Parse questions from JSON string or newline-separated
        try:
            import json

            questions = json.loads(questions_str)
            if not isinstance(questions, list):
                questions = questions_str.split("\n")
        except json.JSONDecodeError:
            questions = [q.strip() for q in questions_str.split("\n") if q.strip()]
    else:
        questions = DEFAULT_ANALYSIS_QUESTIONS

    # Get template (priority: env var > config file > default)
    template = (
        env.get("ANALYSIS_TEMPLATE", analysis_config.get("template", ""))
        or DEFAULT_ANALYSIS_TEMPLATE_MULTIMODAL
    )

    # Get theme (priority: env var > config file > default)
    theme = env.get("NOTE_THEME", analysis_config.get("theme", "orange-heart"))

    # Get custom theme config if provided
    custom_theme_str = env.get("NOTE_THEME_CONFIG", "")
    custom_theme_config = {}
    if custom_theme_str:
        try:
            import json

            custom_theme_config = json.loads(custom_theme_str)
        except json.JSONDecodeError:
            pass

    # Get theme preset
    theme_preset = THEME_PRESETS.get(theme, THEME_PRESETS["orange-heart"])

    # Merge custom theme config with preset
    if custom_theme_config:
        theme_config = {**theme_preset, **custom_theme_config}
    else:
        theme_config = theme_preset

    return {
        "questions": questions,
        "template": template,
        "theme": theme,
        "theme_config": theme_config,
    }


def get_analysis_questions() -> list[str]:
    """
    Get the list of analysis questions.

    Returns:
        List of analysis question strings.
    """
    config = get_analysis_config()
    return config["questions"]


def get_analysis_template() -> str:
    """
    Get the analysis template string.

    Returns:
        Analysis template string.
    """
    config = get_analysis_config()
    return config["template"]


def get_note_theme_config() -> dict[str, str]:
    """
    Get the note theme configuration.

    Returns:
        Dictionary with theme configuration values.
    """
    config = get_analysis_config()
    return config["theme_config"]


def get_multimodal_analysis_template() -> str:
    """
    Backward-compatible helper that returns the unified analysis template.

    Returns:
        Analysis template string.
    """
    return get_analysis_template()


def format_multimodal_section(
    images: list[dict[str, Any]],
    tables: list[dict[str, Any]],
) -> str:
    """
    Format multi-modal content (images and tables) for analysis template.

    Args:
        images: List of image metadata dictionaries with 'page' key.
        tables: List of table metadata with 'page' key and 'content' list.

    Returns:
        Formatted string with image and table sections.
    """
    sections = []

    # Images section
    if images:
        sections.append("## å›¾ç‰‡å†…å®¹\n\n")
        sections.append(f"æœ¬æ–‡æ¡£åŒ…å« {len(images)} ä¸ªå›¾ç‰‡ï¼š\n\n")
        for i, img in enumerate(images, 1):
            sections.append(f"### å›¾ç‰‡ {i} (ç¬¬ {img.get('page', '?')} é¡µ)\n")
            sections.append(f"[å›¾ç‰‡ {i} ä½äºŽç¬¬ {img.get('page', '?')} é¡µ]\n\n")

    # Tables section
    if tables:
        sections.append("## è¡¨æ ¼å†…å®¹\n\n")
        sections.append(f"æœ¬æ–‡æ¡£åŒ…å« {len(tables)} ä¸ªè¡¨æ ¼ï¼š\n\n")
        for i, table in enumerate(tables, 1):
            sections.append(f"### è¡¨æ ¼ {i} (ç¬¬ {table.get('page', '?')} é¡µ)\n")
            content = table.get("content", [])
            if content and len(content) > 0:
                preview = content[: min(5, len(content))]
                for row in preview:
                    sections.append(f"{' | '.join(str(cell) for cell in row)}\n")
            sections.append("\n")

    return "".join(sections)
